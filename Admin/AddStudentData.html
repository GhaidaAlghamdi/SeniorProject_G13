<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Add Student </title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="FormCreateAccount.css">
  <link href="Trans.css" rel="stylesheet">
  <style>
    .carding {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: auto;
      position: flex;
    }

    .card {

      top: 50%;
      left: 50%;
      height: 570px;
      width: 320px;

      background-color: rgb(255 255 255 / 49%);
      -webkit-backdrop-filter: blur(20px);
      backdrop-filter: blur(20px);


      border-radius: 8px;
      -webkit-box-shadow: 20px 20px 22px rgba(0, 0, 0, 0.2);
      box-shadow: 20px 20px 22px rgba(0, 0, 0, 0.2);
      font-family: 'Poppins', sans-serif;
      margin: 30px;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      display: relative;
      align-items: center;
      justify-content: center;

    }

    img {
      border-radius: 90%;
      margin: 13px;
      width: 300px
    }

    button.btn {
      height: 100%;
      width: 100%;
      border-radius: 5px;
      border: none;
      color: #fff;
      font-size: 18px;
      font-weight: 500;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #64949c;
      height: 45px;
      margin: 35px 0
    }

    button.btn:hover {
      /* transform: scale(0.99); */
      background: linear-gradient(-135deg, #71b7e6, #9b59b6);
    }
  </style>
</head>

<body>



  <header class="l-header">
    <nav class="nav bd-grid">


      <div>
        <a href="#" class="nav__logo">نُظِّمْ.</a>
      </div>

      <div class="nav__toggle" id="nav-toggle">
        <i class='bx bx-menu'></i>
      </div>

      <div class="nav__menu" id="nav-menu">
        <div class="nav__close" id="nav-close">
          <i class='bx bx-x'></i>
        </div>

        <ul class="nav__list">
          <li class="nav__item"><a href="#home" class="nav__link active">الانشطة</a></li>
          <li class="nav__item"><a href="#about" class="nav__link">الاشعارات</a></li>
          <li class="nav__item"><a href="#skills" class="nav__link">المحادثات</a></li>
          <li class="nav__item"><a href="#contact" class="nav__link"> تصاريح</a></li>
        </ul>
      </div>
    </nav>
  </header>
  <div class="home__container bd-grid">
    <div class="background">


      <div class="carding">
        <div class="containerr">
          <div class="title">Add Student Data</div>
          <div class="content">
            <form action="#">
              <div class="user-details">
                <div class="input-box">
                  <span class="details">Student ID</span>
                  <input type="text" id="sId" placeholder="Enter Student ID" required>
                </div>
                <div class="input-box">
                  <span class="details">Student Name</span>
                  <input type="text" id="sName" placeholder="Enter Student Name" required>
                </div>
                <div class="input-box">
                  <span class="details">Student Age</span>
                  <input id="sAge" type="number" min="1" max="12">
                </div>

                <div class="input-box">
                  <span class="details">Student Grade</span>
                  <select class="custom-select " id="sGrade" name="sGrade">
                    <option>-------Select student Grade----------</option>
                    <option value="1">First Grade</option>
                    <option value="2">Second Grade</option>
                    <option value="3">Third Grade</option>
                    <option value="4">Fourth Grade</option>
                    <option value="5">Fifth Grade</option>
                    <option value="6">Sixth Grade</option>
                  </select>
                  <!-- <input id="sGrade" type="text" placeholder="Enter Student Grade" required> -->
                </div>
                <div class="input-box">
                  <span class="details">Parent Id</span>
                  <input type="text" id="pId" placeholder="Enter Parent Id" required>

                </div>
              </div>
              <div class="gender-details">
                <input type="radio" name="gender" checked id="dot-1">
                <input type="radio" name="gender" id="dot-2">
                <span class="gender-title">Gender</span>
                <div class="category">
                  <label for="dot-1">
                    <span class="dot one"></span>
                    <span class="gender">Male</span>
                  </label>
                  <label for="dot-2">
                    <span class="dot two"></span>
                    <span class="gender">Female</span>
                  </label>

                </div>
              </div>


              <div>
                <button id="Add" class="btn">Add Student</button>
              </div>
            </form>
          </div>
        </div>



        <div class="card" style="text-align: center;">
          <label style="padding:10%; font-size: 40px; ">Student</label>

          <img src="child.jpg" alt="Avatar">
        </div>

      </div>
    </div>
  </div>












  <!--===== GSAP =====-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.min.js"></script>

  <!-- ===== MAIN JS =====
<script src="main.js"></script>
<script src="qrcode.js"></script>
<script src="app.js"></script> -->


  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
    import { getDatabase, ref, child, set, get } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB6Vef9JnY3xB0GL2PwE_HbXLgt3HeOAfw",
      authDomain: "authentication-7b4e2.firebaseapp.com",
      databaseURL: "https://authentication-7b4e2-default-rtdb.firebaseio.com",
      projectId: "authentication-7b4e2",
      storageBucket: "authentication-7b4e2.appspot.com",
      messagingSenderId: "25287000851",
      appId: "1:25287000851:web:cf131084c87dbd757c10e6"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(getDatabase());
    var add = document.getElementById("Add");

    var gender = "male";

    var sName = document.getElementById("sName");
    var sId = document.getElementById("sId");
    var pId = document.getElementById("pId");
    var sAge = document.getElementById("sAge");
    var sGrade = document.getElementById("sGrade");


    //--------------------Validation-------------------------------
    function validate2() {

      if (document.getElementById("dot-2").checked) {
        gender = "Female";
      }

      var letters = /^[A-Za-z\s]+[A-Za-z\s]+[A-Za-z\s]+[A-Za-z\s]$/;
      var email1 = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@(gmail)\.com/;
      var regexPhoneNumber = /^([0-9]{3})([0-9]{3})([0-9]{4})$/;
      var regexID = /^([0-9]{10})$/;

      // name Validate is null
      if (pId.value == "") {
        alert('Parent Id is required');
        return;
      }
      else if (!letters.test(sName.value)) {
        alert('Name is incorrect must contain alphabets only');
        return;
      }

      // parent id Validate is null
      else if (sId.value == "") {
        alert('student ID is required');
        return;
      }
     
     
      // id validate
      else if (!regexID.test(pId.value)) {
        alert("Parent ID must is 10 digit");
        return;
      }


      else if (sAge.value == "") {
        alert('Age is required');
        return;
      }


      //email validate
      else if (sGrade.value == "") {
        alert('Grade is required');
        return;
      }

      return true;
    }//end validate

    //----------------------------insert---------------------------

    //-----------------------assign button--------------------
    add.addEventListener("click", saveStudentData);

    function saveStudentData() {
      if (!validate2()) {
        return;
      };
      CheckForParent();
    }
    function sendStudentData() {

      get(child(dbRef, `Student/` + sId.value)).then((snapshot) => {
        if (snapshot.exists()) {
         alert("student id exit before");
       
        } else{
          set(ref(db, "Student/" + sId.value), {
        StudentId: sId.value,
        ParentId: pId.value,
        Age: sAge.value,
        Gender: gender,
        Grade: sGrade.value,
        name: sName.value
      }) .then(() => {
          alert(" Add Student's data successfully");
        })
        .catch((error) => {
          alert(error);
        });
        }
      })
     
    }
   
   
    function CheckForParent() {

      var isFound = false;
      const dbRef = ref(getDatabase());
      get(child(dbRef, `Parent`)).then((snapshot) => {
        if (snapshot.exists()) {

          snapshot.forEach((childSnapshot) => {
            var key = childSnapshot.key;
            var data = childSnapshot.val();

            if (String(data['id']) == String(pId.value)) {
              isFound = true;
            }

          });
        } else {
          console.log("No data available");
        }
      }).then(function () {

        if (!isFound) {
          alert("Cann't find parent with this id add parent file first");
        } else {
          sendStudentData();
        }

      }).catch((error) => {
        console.error(error);
      });

    }
  </script>
</body>

</html>